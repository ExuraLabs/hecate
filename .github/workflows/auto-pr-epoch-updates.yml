name: Create Epoch Update PR

on:
  push:
    branches:
      - automated/epoch-updates

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract epoch number from commit
        id: extract-epoch
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)
          EPOCH=$(echo "$COMMIT_MSG" | grep -oP "epoch \K\d+")
          echo "epoch=$EPOCH" >> $GITHUB_OUTPUT

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Update epoch data to epoch ${{ steps.extract-epoch.outputs.epoch }}"
          title: "🔄 Epoch data update for Epoch ${{ steps.extract-epoch.outputs.epoch }}"
          body: |
            ## 📊 Automated Epoch Update

            This PR updates epoch boundaries and block data for **Epoch ${{ steps.extract-epoch.outputs.epoch }}**.

            ### 🔍 Changes:
            - Updated `data/epoch_boundaries.csv`
            - Updated `data/epoch_blocks.csv`
            - Updated `flows/checkpoint.json`

            Auto-generated by the `fetch_epoch_data_flow` run on Prefect.
          branch: automated/epoch-updates
          base: master
          labels: |
            automated
            epoch-update
